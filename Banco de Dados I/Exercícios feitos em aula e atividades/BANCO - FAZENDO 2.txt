USE BD1
GO
IF EXISTS(SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = 'empress') DROP TABLE empress;
GO

CREATE TABLE PESSOA
    (
	ID INT IDENTITY(1,1)NOT NULL,
	NOME VARCHAR(30)
	)
ALTER TABLE PESSOA ADD CONSTRAINT PK_PESSOA PRIMARY KEY (ID)
	
CREATE TABLE FISICA
	(
	ID INT NOT NULL,
	CPF VARCHAR(11)
	)
ALTER TABLE FISICA ADD CONSTRAINT FK_PESSOA FOREIGN KEY (ID) REFERENCES PESSOA (ID)
	
CREATE TABLE JURIDICA
	(
	ID INT NOT NULL,
	CNPJ VARCHAR(14)
	)
ALTER TABLE JURIDICA ADD CONSTRAINT FK_PESSOAJURIDICA FOREIGN KEY (ID) REFERENCES PESSOA (ID)

CREATE TABLE PRODUTO
	(
	ID INT IDENTITY(1,1)NOT NULL,
	DESCRICAO VARCHAR(30)
	)
ALTER TABLE PRODUTO ADD CONSTRAINT FK_PRODUTO PRIMARY KEY(ID)

CREATE TABLE PEDIDO
	(
	ID INT IDENTITY(1,1)NOT NULL,
	DATA DATETIME DEFAULT (GETDATE()),
	ID_PESSOA INT NOT NULL
	)
ALTER TABLE PEDIDO ADD CONSTRAINT FK_PEDIDO PRIMARY KEY(ID)	
ALTER TABLE PEDIDO ADD CONSTRAINT FK_PEDIDO_PESSOA FOREIGN KEY (ID_PESSOA) REFERENCES PESSOA (ID)

CREATE TABLE PEDIDO_PRODUTO
	(
	ID_PEDIDO INT NOT NULL,
	ID_PRODUTO INT NOT NULL,
	QUANTIDADE INT,
	VALOR_UNITARIO NUMERIC(10,2)
	)

	
--ALTER TABLE PEDIDO_PRODUTO ADD CONSTRAINT PK_PEDIDO_PRODUTO PRIMARY KEY(ID_PEDIDO, ID_PRODUTO)
--ALTER TABLE PEDIDO_PRODUTO ADD CONSTRAINT FK_PEDIDO_PRODUTO_PEDIDO FOREIGN KEY (ID_PEDIDO) REFERENCES PEDIDO(ID)

--ALTER TABLE PEDIDO_PRODUTO ADD CONSTRAINT FK_PEDIDO_PRODUTO_PRODUTO FOREIGN KEY (ID_PRODUTO) REFERENCES PRODUTO(ID)


INSERT INTO PESSOA (NOME) VALUES ('MARCIO')
INSERT INTO PESSOA (NOME) VALUES ('DANIEL')
INSERT INTO PESSOA (NOME) VALUES ('PUNTEL')
DELETE FROM PESSOA WHERE ID=2
SELECT * FROM PESSOA

INSERT INTO FISICA (ID, CPF) VALUES (1,'22333')
INSERT INTO JURIDICA (ID, CNPJ) VALUES (1,'5567')
SELECT CPF, ID FROM FISICA
SELECT CNPJ, ID FROM JURIDICA

INSERT INTO PRODUTO (DESCRICAO) VALUES ('FRALDA')
INSERT INTO PRODUTO (DESCRICAO) VALUES ('CALCINHA')
SELECT * FROM PRODUTO
	
INSERT INTO PEDIDO (ID_PESSOA) VALUES (3)
SELECT *FROM PEDIDO

ALTER TABLE PEDIDO_PRODUTO 
ALTER TABLE PEDIDO_PRODUTO ADD VALOR_UNITARIO
	NUMERIC(10,2) CHECK (VALOR_UNITARIO >10)
ALTER TABLE PEDIDO_PRODUTO ADD QUANTIDADE
	INT CHECK (QUANTIDADE >5)