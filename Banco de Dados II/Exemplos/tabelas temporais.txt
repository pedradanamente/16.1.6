CREATE PROCEDURE SP_STATUS
AS

CREATE TABLE #TEMP_STATUS(ID INT, DATA DATE, SITUACAO VARCHAR(10))
DECLARE MEUCURSOR CURSOR FOR
	SELECT ID, DATA FROM VEDAS;

DECLARE @ID INT, @DATA DATE, @SITUACAO VARCHAR(10)

FETCH NEXT FROM MEUCURSOR INTO @ID, @DATA

WHILE(@@FETCH_STATUS=0)


BEGIN
IF(EXISTS(SELECT ID_VENDA FROM PAGAMENTO WHERE ID_VENDA=@ID))
	SET @SITUACAO = 'PAGA'

ELSE
	SET @SITUACAO = 'PENDENTE'

FETCH NEXT FROM MEUCURSOR INTO @ID, @DATA


INSERT INTO #TEMP_STATUS (ID, DATA, SITUACAO) VALUES (@ID, @DATA, @SITUACAO)
END

SELECT * FROM * TEMP_STATUS